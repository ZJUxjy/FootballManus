# 开发计划

## 总体时间线

```
Phase 1 (2-3周)      Phase 2 (2周)       Phase 3 (3周)       Phase 4 (2周)       Phase 5 (持续)
    │                    │                   │                   │                   │
    ▼                    ▼                   ▼                   ▼                   ▼
┌──────────┐        ┌──────────┐       ┌──────────┐       ┌──────────┐       ┌──────────┐
│ 数据层   │   ──▶  │ 比赛引擎 │  ──▶  │ 系统核心 │  ──▶  │ LLM接入  │  ──▶  │ 完善优化 │
│ 基础设施 │        │ 验证     │       │ 完善     │       │ 多人联机 │       │ 迭代     │
└──────────┘        └──────────┘       └──────────┘       └──────────┘       └──────────┘
```

---

## Phase 1: 数据层与基础设施 (第1-3周)

### Week 1: 项目骨架搭建

#### Day 1-2: 项目初始化
- [x] 创建项目目录结构
- [ ] 初始化 Python 项目 (pyproject.toml)
- [ ] 配置虚拟环境
- [ ] 安装核心依赖 (FastAPI, SQLAlchemy, Rich, etc.)
- [ ] 配置开发工具 (black, ruff, mypy)

#### Day 3-4: 数据库设计实现
- [ ] 创建 SQLAlchemy 模型
  - [ ] Player 模型
  - [ ] Club 模型
  - [ ] League 模型
  - [ ] Match 模型
  - [ ] Transfer 模型
- [ ] 数据库迁移脚本
- [ ] 基础 CRUD 操作

#### Day 5-7: 数据获取模块
- [ ] 设计数据获取接口
- [ ] 实现 Football-Data.org API 客户端
- [ ] 实现数据解析器
- [ ] 创建数据导入脚本
- [ ] 添加错误处理和重试机制

### Week 2-3: 球员数据库建设

#### 数据源整合
- [ ] 获取真实球员数据 (Top 5 Leagues)
  - [ ] 英超 (20队 x 25人 = 500人)
  - [ ] 西甲 (20队 x 25人 = 500人)
  - [ ] 德甲 (18队 x 25人 = 450人)
  - [ ] 意甲 (20队 x 25人 = 500人)
  - [ ] 法甲 (18队 x 25人 = 450人)
- [ ] 设计球员能力值计算算法
- [ ] 生成青训球员模板

#### 数据验证
- [ ] 编写数据完整性检查
- [ ] 球员能力值分布验证
- [ ] 俱乐部财政平衡检查
- [ ] 联赛结构验证

#### 交付物
- [ ] 完整的 SQLite 数据库 (~2500名球员)
- [ ] 数据获取脚本
- [ ] 数据验证报告

---

## Phase 2: 比赛模拟器 (第4-5周)

### Week 4: 核心模拟引擎

#### Day 1-2: 实力计算系统
- [ ] 设计球员能力加权算法
- [ ] 阵容平衡度计算
- [ ] 战术匹配度计算
- [ ] 主客场影响因子

#### Day 3-5: 比赛模拟算法
- [ ] 事件概率模型
  - [ ] 进球概率
  - [ ] 红黄牌概率
  - [ ] 换人事件
- [ ] 实时比分更新
- [ ] 比赛事件记录

#### Day 6-7: 测试与验证
- [ ] 选取真实比赛数据
- [ ] 模拟 vs 真实结果对比
- [ ] 调整参数使结果合理
  - 主场胜率 ~55%
  - 平均进球数 ~2.5球/场
  - 平局率 ~25%

### Week 5: 赛季模拟

- [ ] 赛程生成器
- [ ] 积分计算系统
- [ ] 排名规则实现
- [ ] 升降级逻辑
- [ ] 赛季统计 (射手榜、助攻榜)

#### 交付物
- [ ] 可独立运行的比赛模拟器
- [ ] 验证报告 (模拟结果 vs 真实数据)
- [ ] 赛季模拟演示

---

## Phase 3: 核心系统 (第6-8周)

### Week 6: 财政系统

- [ ] 收入计算
  - [ ] 门票收入 = 票价 × 上座率 × 容量
  - [ ] 转播分成 (按排名)
  - [ ] 商业赞助 (基于声望)
- [ ] 支出计算
  - [ ] 周薪发放
  - [ ] 青训维护费
  - [ ] 球探网络费用
- [ ] 财政公平 (FFP) 检查

### Week 7: 转会系统

#### Day 1-3: 转会引擎
- [ ] 报价发起 API
- [ ] 报价接受/拒绝/还价逻辑
- [ ] 合同谈判模拟
- [ ] 解约金机制
- [ ] 租借系统

#### Day 4-5: 球员 AI 行为
- [ ] 球员意愿计算
  - [ ] 对报价的兴趣度
  - [ ] 对俱乐部的吸引力
  - [ ] 忠诚度和野心

#### Day 6-7: 转会窗口
- [ ] 夏窗/冬窗开关
- [ ]  Deadline Day 特殊逻辑
- [ ] 转会历史记录

### Week 8: 青训系统

- [ ] 青训球员生成
  - [ ] 潜力新星生成算法
  - [ ] 国籍分布
  - [ ] 位置分布
- [ ] 球员成长系统
  - [ ] 比赛经验获取
  - [ ] 训练效果
  - [ ] 年龄影响曲线
- [ ] 球探系统
  - [ ] 发现外部年轻球员
  - [ ] 球探报告

#### 交付物
- [ ] 完整的游戏循环 (赛季推进)
- [ ] 转会演示
- [ ] 青训演示

---

## Phase 4: LLM接入与多人联机 (第9-10周)

### Week 9: LLM 集成

#### Day 1-2: LLM 客户端
- [ ] OpenAI API 封装
- [ ] 兼容其他 LLM (Claude, Local LLM)
- [ ] 响应缓存
- [ ] 错误处理

#### Day 3-5: AI 经理实现
- [ ] 提示词工程
  - [ ] 系统角色定义
  - [ ] 上下文构建
  - [ ] 决策格式定义
- [ ] 决策解析器
- [ ] 行动执行器

#### Day 6-7: AI 测试
- [ ] 单场景测试
- [ ] 长周期模拟测试
- [ ] 决策合理性评估

### Week 10: 多人联机

#### Day 1-3: 服务器实现
- [ ] FastAPI WebSocket 服务
- [ ] 房间管理系统
- [ ] 玩家连接管理
- [ ] 状态同步机制

#### Day 4-5: CLI 客户端
- [ ] Rich UI 界面
- [ ] WebSocket 连接
- [ ] 命令解析
- [ ] 实时更新显示

#### Day 6-7: 完整联机测试
- [ ] 多客户端连接
- [ ] 并发操作测试
- [ ] 网络断线重连

#### 交付物
- [ ] 可联机游玩的 MVP
- [ ] AI 经理演示
- [ ] 完整游戏流程视频

---

## Phase 5: 完善与迭代 (第11周+ 持续)

### 功能完善
- [ ] 欧冠/欧联赛制
- [ ] 国内杯赛
- [ ] 国家队比赛
- [ ] 球员伤病系统
- [ ] 球员化学反应
- [ ] 媒体与球迷系统
- [ ] 成就系统
- [ ] 存档/读档

### 性能优化
- [ ] 数据库查询优化
- [ ] 比赛模拟性能
- [ ] LLM 响应优化
- [ ] 内存使用优化

### 用户体验
- [ ] 更丰富的 CLI 界面
- [ ] 新手引导
- [ ] 帮助系统
- [ ] 配置文件支持

---

## 技术里程碑检查点

| 检查点 | 日期 | 验证标准 |
|-------|------|---------|
| CP1 | Week 1 结束 | 数据库可创建，模型验证通过 |
| CP2 | Week 3 结束 | 包含2500+球员的完整数据库 |
| CP3 | Week 5 结束 | 模拟器输出合理比赛结果 |
| CP4 | Week 8 结束 | 可完成一个完整赛季模拟 |
| CP5 | Week 10 结束 | 多人可联机游玩完整流程 |
| CP6 | Week 12 结束 | 发布 MVP 版本 |

---

## 开发规范

### 代码规范
- 使用 Black 格式化代码
- 使用 Ruff 进行代码检查
- 类型注解覆盖率 > 80%
- 核心函数必须有文档字符串

### 测试策略
- 单元测试覆盖核心逻辑
- 集成测试覆盖完整流程
- 使用 pytest 框架

### 版本管理
- 使用 Git 版本控制
- 功能分支工作流
- 提交信息规范: `type(scope): message`

---

## 当前优先级

### 🔥 最高优先级 (立即开始)
1. 项目骨架搭建
2. 数据库模型实现
3. 基础数据导入

### ⚡ 高优先级 (Phase 1)
4. 球员数据获取
5. 数据验证

### 📋 中优先级 (Phase 2-3)
6. 比赛模拟器
7. 财政/转会/青训系统

### 📅 低优先级 (Phase 4-5)
8. LLM 集成
9. 多人联机
10. 功能完善
