# 开发计划

## 总体时间线

```
Phase 1 (2-3周)      Phase 2 (2周)       Phase 3 (3周)       Phase 4 (2周)       Phase 5 (持续)
    │                    │                   │                   │                   │
    ▼                    ▼                   ▼                   ▼                   ▼
┌──────────┐        ┌──────────┐       ┌──────────┐       ┌──────────┐       ┌──────────┐
│ 数据层   │   ──▶  │ 比赛引擎 │  ──▶  │ 系统核心 │  ──▶  │ LLM集成  │  ──▶  │ 完善优化 │
│ 基础设施 │        │ 验证     │       │ ✅ 完成  │       │ ✅ 完成  │       │ 迭代     │
└──────────┘        └──────────┘       └──────────┘       └──────────┘       └──────────┘
        ✅ 完成            ✅ 完成            ✅ 完成            ✅ 完成              ⏳ 当前
```

---

## ✅ Phase 1-4: 已完成

### Phase 1: 数据层 ✅
- [x] 项目骨架搭建
- [x] SQLAlchemy 模型
- [x] 2,779 球员数据库

### Phase 2: 比赛引擎 ✅
- [x] Match Engine V2 (射门机制)
- [x] 赛季模拟器
- [x] 动态状态系统

### Phase 3: 核心系统 ✅
- [x] 财政系统 (收入/支出/FFP)
- [x] 转会系统 (报价/合同/窗口)
- [x] 青训系统 (招生/成长/球探)

### Phase 4: LLM 集成 ✅
- [x] LLM Client (OpenAI/Claude/本地)
- [x] 叙事引擎 (比赛/球员/赛季)
- [x] AI 经理 (8种个性/决策)
- [x] 新闻系统 (分类/优先级)
- [x] 球迷董事会 (情绪/评估)

---

## ⏳ Phase 5: 完善与扩展 (当前)

### Week 11: 杯赛系统

#### 国内杯赛
- [ ] 足总杯/联赛杯赛制
  - [ ] 淘汰赛抽签
  - [ ] 单回合决胜
  - [ ] 重赛规则 (如果需要)
- [ ] 杯赛收入计算
- [ ] 杯赛对联赛的影响

#### 欧冠/欧联
- [ ] 小组赛赛制
  - [ ] 8组×4队
  - [ ] 双循环6场
  - [ ] 前2名晋级
- [ ] 淘汰赛赛制
  - [ ] 两回合制
  - [ ] 客场进球规则
  - [ ] 加时/点球
- [ ] 欧战收入
  - [ ] 参赛奖金
  - [ ] 胜场奖金
  - [ ] 晋级奖金

### Week 12: 球员发展深度

#### 伤病系统
- [ ] 伤病类型数据库
  - [ ] 肌肉伤 (腿筋/腹股沟)
  - [ ] 关节伤 (膝盖/脚踝)
  - [ ] 骨折/骨裂
  - [ ] 疲劳累积
- [ ] 恢复时间计算
- [ ] 伤病复发风险
- [ ] 队医系统影响

#### 化学反应
- [ ] 球员关系网络
  - [ ] 场上默契度
  - [ ] 场外关系
  - [ ] 语言/国籍加成
- [ ] 更衣室氛围
- [ ] 小团体形成

### Week 13: 多人联机

#### 服务器架构
- [ ] FastAPI WebSocket 服务
- [ ] 房间管理系统
- [ ] 玩家连接管理
- [ ] 状态同步机制

#### 游戏房间
- [ ] 创建/加入房间
- [ ] 赛季同步
- [ ] 转会窗口同步
- [ ] 比赛结果广播

#### CLI 客户端
- [ ] WebSocket 连接
- [ ] 实时更新显示
- [ ] 聊天系统

---

## 技术里程碑检查点

| 检查点 | 状态 | 验证标准 |
|-------|------|---------|
| CP1 | ✅ | 数据库可创建，模型验证通过 |
| CP2 | ✅ | 包含2,779球员的完整数据库 |
| CP3 | ✅ | 模拟器输出合理比赛结果 |
| CP4 | ✅ | 财政/转会/青训系统测试通过 |
| CP5 | ✅ | LLM系统可生成叙事和AI决策 |
| CP6 | ⏳ | 杯赛系统可运行完整赛季 |
| CP7 | ⏳ | 多人可联机游玩 |
| CP8 | ⏳ | 发布 MVP v1.0 |

---

## 当前优先级

### 🔥 最高优先级
1. 杯赛系统实现
2. 欧冠/欧联赛制
3. 伤病系统基础

### ⚡ 高优先级
4. 球员化学反应
5. 存档/读档系统
6. 成就系统

### 📋 中优先级
7. 多人联机基础
8. 界面美化
9. 配置系统

### 📅 低优先级
10. 3D比赛可视化
11. 音频解说
12. 移动端适配

---

## 引擎模块总览

```
fm_manager/engine/
├── match_engine_v2.py      # 比赛模拟 ✅
├── season_simulator.py     # 赛季模拟 ✅
├── team_state.py           # 动态状态 ✅
├── finance_engine.py       # 财政系统 ✅
├── transfer_engine.py      # 转会系统 ✅
├── youth_engine.py         # 青训系统 ✅
├── llm_client.py           # LLM 客户端 ✅
├── narrative_engine.py     # 叙事引擎 ✅
├── ai_manager.py           # AI 经理 ✅
├── news_system.py          # 新闻系统 ✅
├── fan_board_system.py     # 球迷董事会 ✅
├── cup_competition.py      # 杯赛系统 ⏳
├── injury_system.py        # 伤病系统 ⏳
└── chemistry_system.py     # 化学反应 ⏳
```

## 文档结构

```
doc/
├── MATCH_SIMULATION_ANALYSIS.md    ✅
├── DYNAMIC_STATE.md                ✅
├── SEASON_SIMULATION.md            ✅
├── FINANCE_SYSTEM.md               ✅
├── TRANSFER_SYSTEM.md              ✅
├── YOUTH_SYSTEM.md                 ✅
├── LLM_INTEGRATION.md              ✅
├── NARRATIVE_SYSTEM.md             ✅
├── AI_MANAGER.md                   ✅
├── NEWS_SYSTEM.md                  ✅
├── FAN_BOARD_SYSTEM.md             ✅
└── CUP_COMPETITION.md              ⏳
```

---

## 发布路线图

### MVP v1.0 (预计 Week 14)
- [ ] 完整联赛赛季
- [ ] 杯赛系统
- [ ] 伤病系统
- [ ] 存档/读档
- [ ] 基础多人联机

### v1.1 (后续)
- [ ] 化学反应系统
- [ ] 更多AI个性
- [ ] 新闻系统增强
- [ ] 性能优化

### v2.0 (远期)
- [ ] 完整多人联机
- [ ] 3D比赛可视化
- [ ] 音频解说
- [ ] 模组支持
